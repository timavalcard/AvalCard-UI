"use client"

import { useEffect, useState } from "react";
import classNames from "classnames";
import Link from "next/link";
import Image from "next/image";
import { menuMain } from "@/constants/data";
import Search from "./Search";
import Support from "./Support";
import Authentication from "./Authentication";
import UserIcon from "./UserIcon";
import MenuMobile from "./MenuMobile";
import { FaAngleDown } from "react-icons/fa6";
import MenuItem from "./subHeader/MenuItem";
import TemplateItem from "./subHeader/TemplateItem";

export default function Header() {
    const [isScrolled, setIsScrolled] = useState(false);
    const [isVisible, setIsVisible] = useState(true);
    const [lastScrollY, setLastScrollY] = useState(0);
    const [hidden, setHidden] = useState(true);


    useEffect(() => {
        const handleScroll = () => {
            const currentScrollY = window.scrollY;

            setIsScrolled(currentScrollY > 100);
            setIsVisible(currentScrollY < lastScrollY || currentScrollY < 100);
            setLastScrollY(currentScrollY);
        };

        window.addEventListener("scroll", handleScroll);
        return () => window.removeEventListener("scroll", handleScroll);
    }, [lastScrollY]);

    return (
        <>
        <div
            className={classNames(
                "w-full fixed top-0 left-0 z-50 transition-all duration-300 shadow-md",
                {
                    "translate-y-0": isVisible,
                    "-translate-y-full": !isVisible,
                    "shadow-md backdrop-blur-md bg-white/80": isScrolled,
                    "bg-white": !isScrolled,
                }
            )}
        >
            <div className="container">
                <div className="md:flex space-y-6 md:space-y-0 justify-between py-5 relative z-10">

                    <div className="flex gap-6 items-center md:justify-start justify-between">
                        <Link href={'/'} className="ml-2">
                            <img src={'/images/logo-main.png'} height={49} alt='اول کارت' className="h-[48px] -mt-5 w-[200px]  object-cover" />
                        </Link>
                        <div className="gap-6 items-center hidden md:flex">

                            <TemplateItem title={
                                <div className="flex gap-2 text-gray-custom font-semibold items-center">
                                    <div>
                                        خدمات
                                    </div>
                                    <div>
                                        <FaAngleDown />
                                    </div>
                                </div>
                            }>
                                <div className="w-96">
                                    <div className="grid grid-cols-1">
                                        <MenuItem
                                            title={'خرید گیفت کارت'}
                                            icon={<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M2.33337 18.249H23.1667M7.54171 10.9573L10.6667 7.83232M14.8334 7.83232L17.9584 10.9573M4.41671 22.4156H21.0834C22.234 22.4156 23.1667 21.4829 23.1667 20.3323V9.91565C23.1667 8.76506 22.234 7.83232 21.0834 7.83232H4.41671C3.26611 7.83232 2.33337 8.76506 2.33337 9.91565V20.3323C2.33337 21.4829 3.26611 22.4156 4.41671 22.4156ZM11.7084 5.74898C11.7084 6.89958 10.7756 7.83232 9.62504 7.83232C8.47445 7.83232 7.54171 6.89958 7.54171 5.74898C7.54171 4.59839 8.47445 3.66565 9.62504 3.66565C10.7756 3.66565 11.7084 4.59839 11.7084 5.74898ZM17.9584 5.74898C17.9584 6.89958 17.0256 7.83232 15.875 7.83232C14.7244 7.83232 13.7917 6.89958 13.7917 5.74898C13.7917 4.59839 14.7244 3.66565 15.875 3.66565C17.0256 3.66565 17.9584 4.59839 17.9584 5.74898Z" stroke="#464646" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                            }
                                            href="/gift-card"



                                        />
                                        <MenuItem
                                            title={'نقد کردن درآمد ارزی'}
                                            href="/currency-income"
                                            icon={<svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M18 1.03012H3.41671C2.26611 1.03012 1.33337 2.14941 1.33337 3.53012V13.5301M7.58337 18.5301H20.0834C21.234 18.5301 22.1667 17.4108 22.1667 16.0301V8.53012C22.1667 7.14941 21.234 6.03012 20.0834 6.03012H7.58337C6.43278 6.03012 5.50004 7.14941 5.50004 8.53012V16.0301C5.50004 17.4108 6.43278 18.5301 7.58337 18.5301ZM15.9167 12.2801C15.9167 13.6608 14.984 14.7801 13.8334 14.7801C12.6828 14.7801 11.75 13.6608 11.75 12.2801C11.75 10.8994 12.6828 9.78012 13.8334 9.78012C14.984 9.78012 15.9167 10.8994 15.9167 12.2801Z" stroke="#464646" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                            }
                                        />
                                        <MenuItem
                                            title={'پرداخت در وب‌سایت‌های خارجی'}
                                            href="/foreign-payment"
                                            icon={<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M8.75058 4.98353L8.907 5.97122V5.97122L8.75058 4.98353ZM9.69381 4.59283L10.2816 5.40184V5.40184L9.69381 4.59283ZM4.77083 7.14358L3.78314 6.98715L4.77083 7.14358ZM6.58846 5.32594L6.43204 4.33825L6.58846 5.32594ZM4.03771 10.2489L3.2287 9.66113H3.2287L4.03771 10.2489ZM4.42841 9.30569L5.4161 9.46211L4.42841 9.30569ZM2.75099 14.5904L1.94198 15.1782H1.94198L2.75099 14.5904ZM2.75099 12.0199L3.56 12.6077L2.75099 12.0199ZM4.42841 17.3046L5.4161 17.1482L4.42841 17.3046ZM4.03771 16.3614L4.84672 15.7736H4.84672L4.03771 16.3614ZM6.58846 21.2844L6.74488 20.2967L6.58846 21.2844ZM4.77083 19.4667L3.78314 19.6232L4.77083 19.4667ZM9.69381 22.0175L10.2816 21.2085L9.69381 22.0175ZM8.75058 21.6268L8.59416 22.6145L8.75058 21.6268ZM14.0353 23.3042L14.6231 24.1132L14.0353 23.3042ZM11.4648 23.3042L10.877 24.1132L11.4648 23.3042ZM16.7495 21.6268L16.9059 22.6145L16.7495 21.6268ZM15.8063 22.0175L15.2185 21.2085L15.8063 22.0175ZM20.7293 19.4667L19.7416 19.3103L20.7293 19.4667ZM18.9116 21.2844L18.7552 20.2967L18.9116 21.2844ZM21.4624 16.3614L20.6534 15.7736L21.4624 16.3614ZM21.0717 17.3046L22.0594 17.461L21.0717 17.3046ZM22.7491 12.0199L23.5581 11.4321V11.4321L22.7491 12.0199ZM22.7491 14.5904L23.5581 15.1782L22.7491 14.5904ZM21.0717 9.30569L22.0594 9.14927L21.0717 9.30569ZM21.4624 10.2489L20.6534 10.8367V10.8367L21.4624 10.2489ZM18.9116 5.32594L19.068 4.33825L18.9116 5.32594ZM20.7293 7.14357L19.7416 7.3L20.7293 7.14357ZM15.8063 4.59283L15.2185 5.40184V5.40184L15.8063 4.59283ZM16.7495 4.98353L16.5931 5.97122L16.7495 4.98353ZM14.0353 3.3061L14.6231 2.4971V2.4971L14.0353 3.3061ZM11.4648 3.3061L10.877 2.4971V2.4971L11.4648 3.3061ZM10.3321 12.598C9.94162 12.2075 9.30846 12.2075 8.91793 12.598C8.52741 12.9886 8.52741 13.6217 8.91793 14.0123L10.3321 12.598ZM11.7084 15.3885L11.0013 16.0956C11.3918 16.4861 12.025 16.4861 12.4155 16.0956L11.7084 15.3885ZM16.5821 11.9289C16.9727 11.5384 16.9727 10.9052 16.5821 10.5147C16.1916 10.1242 15.5585 10.1242 15.1679 10.5147L16.5821 11.9289ZM13.4475 4.11511L15.2185 5.40184L16.3941 3.78382L14.6231 2.4971L13.4475 4.11511ZM16.5931 5.97122L18.7552 6.31363L19.068 4.33825L16.9059 3.99584L16.5931 5.97122ZM19.7416 7.3L20.084 9.46211L22.0594 9.14927L21.7169 6.98715L19.7416 7.3ZM20.6534 10.8367L21.9401 12.6077L23.5581 11.4321L22.2714 9.66113L20.6534 10.8367ZM21.9401 14.0026L20.6534 15.7736L22.2714 16.9492L23.5581 15.1782L21.9401 14.0026ZM20.084 17.1482L19.7416 19.3103L21.7169 19.6232L22.0594 17.461L20.084 17.1482ZM18.7552 20.2967L16.5931 20.6391L16.9059 22.6145L19.068 22.2721L18.7552 20.2967ZM15.2185 21.2085L13.4475 22.4952L14.6231 24.1132L16.3941 22.8265L15.2185 21.2085ZM12.0526 22.4952L10.2816 21.2085L9.10601 22.8265L10.877 24.1132L12.0526 22.4952ZM8.907 20.6391L6.74488 20.2967L6.43204 22.2721L8.59416 22.6145L8.907 20.6391ZM5.75852 19.3103L5.4161 17.1482L3.44072 17.461L3.78314 19.6232L5.75852 19.3103ZM4.84672 15.7736L3.56 14.0026L1.94198 15.1782L3.2287 16.9492L4.84672 15.7736ZM3.56 12.6077L4.84672 10.8367L3.2287 9.66113L1.94198 11.4321L3.56 12.6077ZM5.4161 9.46211L5.75852 7.3L3.78314 6.98715L3.44072 9.14927L5.4161 9.46211ZM6.74488 6.31363L8.907 5.97122L8.59416 3.99584L6.43204 4.33825L6.74488 6.31363ZM10.2816 5.40184L12.0526 4.11511L10.877 2.4971L9.10601 3.78382L10.2816 5.40184ZM8.907 5.97122C9.40371 5.89255 9.87475 5.69744 10.2816 5.40184L9.10601 3.78382C8.95451 3.89389 8.77911 3.96654 8.59416 3.99584L8.907 5.97122ZM5.75852 7.3C5.83893 6.79226 6.23714 6.39404 6.74488 6.31363L6.43204 4.33825C5.06849 4.5542 3.99908 5.62361 3.78314 6.98715L5.75852 7.3ZM4.84672 10.8367C5.14233 10.4299 5.33744 9.95883 5.4161 9.46211L3.44072 9.14927C3.41143 9.33423 3.33878 9.50963 3.2287 9.66113L4.84672 10.8367ZM3.56 14.0026C3.25783 13.5867 3.25783 13.0236 3.56 12.6077L1.94198 11.4321C1.13051 12.549 1.13051 14.0613 1.94198 15.1782L3.56 14.0026ZM5.4161 17.1482C5.33744 16.6515 5.14233 16.1804 4.84672 15.7736L3.2287 16.9492C3.33878 17.1007 3.41143 17.2761 3.44072 17.461L5.4161 17.1482ZM6.74488 20.2967C6.23714 20.2163 5.83893 19.8181 5.75852 19.3103L3.78314 19.6232C3.99908 20.9867 5.06849 22.0561 6.43204 22.2721L6.74488 20.2967ZM10.2816 21.2085C9.87475 20.9129 9.40371 20.7178 8.907 20.6391L8.59416 22.6145C8.77912 22.6438 8.95452 22.7164 9.10601 22.8265L10.2816 21.2085ZM13.4475 22.4952C13.0316 22.7974 12.4685 22.7974 12.0526 22.4952L10.877 24.1132C11.9939 24.9247 13.5062 24.9247 14.6231 24.1132L13.4475 22.4952ZM16.5931 20.6391C16.0964 20.7178 15.6253 20.9129 15.2185 21.2085L16.3941 22.8265C16.5456 22.7164 16.721 22.6438 16.9059 22.6145L16.5931 20.6391ZM19.7416 19.3103C19.6612 19.8181 19.2629 20.2163 18.7552 20.2967L19.068 22.2721C20.4316 22.0561 21.501 20.9867 21.7169 19.6232L19.7416 19.3103ZM20.6534 15.7736C20.3578 16.1804 20.1626 16.6515 20.084 17.1482L22.0594 17.461C22.0887 17.2761 22.1613 17.1007 22.2714 16.9492L20.6534 15.7736ZM21.9401 12.6077C22.2423 13.0236 22.2423 13.5867 21.9401 14.0026L23.5581 15.1782C24.3696 14.0613 24.3696 12.549 23.5581 11.4321L21.9401 12.6077ZM20.084 9.46211C20.1626 9.95882 20.3578 10.4299 20.6534 10.8367L22.2714 9.66113C22.1613 9.50963 22.0887 9.33423 22.0594 9.14927L20.084 9.46211ZM18.7552 6.31363C19.2629 6.39404 19.6612 6.79226 19.7416 7.3L21.7169 6.98715C21.501 5.62361 20.4316 4.5542 19.068 4.33825L18.7552 6.31363ZM15.2185 5.40184C15.6253 5.69744 16.0964 5.89255 16.5931 5.97122L16.9059 3.99584C16.721 3.96654 16.5456 3.89389 16.3941 3.78382L15.2185 5.40184ZM14.6231 2.4971C13.5062 1.68562 11.9939 1.68562 10.877 2.4971L12.0526 4.11511C12.4685 3.81295 13.0316 3.81295 13.4475 4.11511L14.6231 2.4971ZM8.91793 14.0123L11.0013 16.0956L12.4155 14.6814L10.3321 12.598L8.91793 14.0123ZM12.4155 16.0956L16.5821 11.9289L15.1679 10.5147L11.0013 14.6814L12.4155 16.0956Z" fill="#464646" />
                                            </svg>
                                            }

                                        />
                                        <MenuItem
                                            title={'خرید کالا از وب سایت‌های خارجی'}
                                            href="/buy-deliver-iran"
                                            icon={<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M22.6265 10.7482V7.10241C22.6265 5.95181 21.6958 5.01907 20.5476 5.01907H4.95553C3.80736 5.01907 2.87659 5.95181 2.87659 7.10241V19.6024C2.87659 20.753 3.80736 21.6857 4.95553 21.6857H20.5476C21.6958 21.6857 22.6265 20.753 22.6265 19.6024V15.9566M23.7099 15.9566H19.0323C17.5971 15.9566 16.4336 14.7906 16.4336 13.3524C16.4336 11.9142 17.5971 10.7482 19.0323 10.7482H23.7099V15.9566Z" stroke="#464646" stroke-width="2" stroke-linejoin="round" />
                                            </svg>
                                            }

                                        />
                                    </div>
                                </div>
                            </TemplateItem>

                            {
                                menuMain.map(item =>
                                    <Link href={item.href} className="flex gap-2 text-gray-custom font-semibold items-center">
                                        <div>
                                            {item.svg}
                                        </div>
                                        <div>
                                            {item.value}
                                        </div>
                                    </Link>
                                )
                            }

                        </div>

                        <div className="md:hidden cursor-pointer" onClick={() => setHidden(false)}>
                            <svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="23" cy="23" r="23" fill="white" fill-opacity="0.5" />
                                <path d="M15 16.25H25" stroke="#4286F1" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M15 22.25H32" stroke="black" stroke-opacity="0.4" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M22 28.25L32 28.25" stroke="#4286F1" stroke-width="1.5" stroke-linecap="round" />
                            </svg>
                        </div>

                    </div>

                    <div className="flex gap-4">
                        <Search />
                        <Support />
                        <div className="md:block hidden w-full">
                            <Authentication />
                        </div>
                        <div className="md:hidden">
                            <UserIcon />
                        </div>
                    </div>
                </div>
            </div>
            <MenuMobile setHidden={setHidden} hidden={hidden} />
        </div>
        <div className="md:min-h-24 min-h-[150px]" />
        </>
    );
}